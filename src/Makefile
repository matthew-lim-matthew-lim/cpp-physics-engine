# Useful Resource: https://www.cs.colby.edu/maxwell/courses/tutorials/maketutor/

# Compiler
CXX = g++

# Conan build directory
CONAN_BUILD_DIR = ../build

# Use pkg-config to get Conan-managed dependencies
PKG_CONFIG_PATH := $(CONAN_BUILD_DIR):$(PKG_CONFIG_PATH)
export PKG_CONFIG_PATH

# Compiler flags
CXXFLAGS = -O3 -Wall -Wextra -std=c++20 -MMD -MP
CXXFLAGS += $(shell PKG_CONFIG_PATH=$(CONAN_BUILD_DIR) pkg-config --cflags sdl2 SDL2_image SDL2_ttf 2>/dev/null || echo "")

# Libraries
LDFLAGS = $(shell PKG_CONFIG_PATH=$(CONAN_BUILD_DIR) pkg-config --libs sdl2 SDL2_image SDL2_ttf 2>/dev/null || echo "-lSDL2 -lSDL2_image -lSDL2_ttf")

# Source files
SRC = main.cpp Ui/Slider.cpp Ui/LabelledSlider.cpp Utility/Vec.cpp Utility/LTexture.cpp Shapes/Shape.cpp Shapes/Rectangle.cpp Shapes/Circle.cpp 

# Put all the obj files in an `obj` directory so the codebase isn't filled with them
ODIR = obj

# Object files (convert .cpp -> .o and place in ODIR)
OBJ = $(patsubst %.cpp, $(ODIR)/%.o, $(SRC))

# Dependency files (automatically generated by -MMD -MP)
DEP = $(OBJ:.o=.d)

# Executable name
TARGET = program

# Default target
all: $(TARGET)

# Link all object files into the final executable
$(TARGET): $(OBJ)
	$(CXX) $(OBJ) -o $(TARGET) $(LDFLAGS)

# Ensure the object directory exists before compiling
$(ODIR)/%.o: %.cpp
	@mkdir -p $(dir $@) 
	$(CXX) $(CXXFLAGS) -c $< -o $@

# Clean up build files
clean:
	rm -rf $(ODIR) $(TARGET)

# Include dependency files (contains header dependencies)
# The - prefix tells Make to not error if .d files don't exist yet
-include $(DEP)